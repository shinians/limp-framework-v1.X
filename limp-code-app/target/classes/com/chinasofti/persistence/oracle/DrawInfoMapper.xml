<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.chinasofti.mapper.oracle.DrawInfoMapper" >
  <resultMap id="BaseResultMap" type="com.chinasofti.domain.DrawInfo" >
    <result column="CD_ID" property="id" jdbcType="VARCHAR" />
    <result column="CD_DRAWNO" property="drawno" jdbcType="VARCHAR" />
    <result column="CD_APPRTIME" property="apprtime" jdbcType="VARCHAR" />
    <result column="CD_ENDTIME" property="endtime" jdbcType="VARCHAR" />
    <result column="CD_DESUNIT" property="desunit" jdbcType="VARCHAR" />
    <result column="CD_ENTID" property="entid" jdbcType="VARCHAR" />
    <result column="CD_RESPPERSION" property="resppersion" jdbcType="VARCHAR" />
    <result column="CD_SHIPNO" property="shipno" jdbcType="VARCHAR" />
    <result column="CD_REBSHIPNUM" property="rebshipnum" jdbcType="DECIMAL" />
    <result column="CD_SHIPLENGTH" property="shiplength" jdbcType="VARCHAR" />
    <result column="CD_TONNAGE" property="tonnage" jdbcType="VARCHAR" />
    <result column="CD_POWER" property="power" jdbcType="VARCHAR" />
    <result column="CD_SPEED" property="speed" jdbcType="VARCHAR" />
    <result column="CD_WATER" property="water" jdbcType="VARCHAR" />
    <result column="CD_SHIPTYPE" property="shiptype" jdbcType="VARCHAR" />
    <result column="CD_SHIPTYPEID" property="shiptypeid" jdbcType="VARCHAR" />
    <result column="CD_SHIPAREA" property="shiparea" jdbcType="VARCHAR" />
    <result column="CD_SHIPAREAID" property="shipareaid" jdbcType="VARCHAR" />
    <result column="CD_PEOPLECOUNT" property="peoplecount" jdbcType="VARCHAR" />
    <result column="CD_JOBAREA" property="jobarea" jdbcType="VARCHAR" />
    <result column="CD_APPLYUNIT" property="applyunit" jdbcType="VARCHAR" />
    <result column="CD_APPLYUNIT_ID" property="applyunitId" jdbcType="VARCHAR" />
    <result column="CD_DRAMSHIPNAME" property="dramshipname" jdbcType="VARCHAR" />
    <result column="CD_ENGINEROOM_TYPE" property="engineroomType" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Example_Where_Clause" >
    <where >
      <foreach collection="oredCriteria" item="criteria" separator="or" >
        <if test="criteria.valid" >
          <trim prefix="(" suffix=")" prefixOverrides="and" >
            <foreach collection="criteria.criteria" item="criterion" >
              <choose >
                <when test="criterion.noValue" >
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause" >
    <where >
      <foreach collection="example.oredCriteria" item="criteria" separator="or" >
        <if test="criteria.valid" >
          <trim prefix="(" suffix=")" prefixOverrides="and" >
            <foreach collection="criteria.criteria" item="criterion" >
              <choose >
                <when test="criterion.noValue" >
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List" >
    CD_ID, CD_DRAWNO, CD_APPRTIME, CD_ENDTIME, CD_DESUNIT, CD_ENTID, CD_RESPPERSION, 
    CD_SHIPNO, CD_REBSHIPNUM, CD_SHIPLENGTH, CD_TONNAGE, CD_POWER, CD_SPEED, CD_WATER, 
    CD_SHIPTYPE, CD_SHIPTYPEID, CD_SHIPAREA, CD_SHIPAREAID, CD_PEOPLECOUNT, CD_JOBAREA, 
    CD_APPLYUNIT, CD_APPLYUNIT_ID, CD_DRAMSHIPNAME, CD_ENGINEROOM_TYPE
  </sql>
  <select id="selectByExample" resultMap="BaseResultMap" parameterType="com.chinasofti.domain.DrawInfoExample" >
    <include refid="OracleDialectPrefix" />
    select
    <if test="distinct" >
      distinct
    </if>
    <include refid="Base_Column_List" />
    from CIS_DRAWINFO
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null" >
      order by ${orderByClause}
    </if>
    <include refid="OracleDialectSuffix" />
  </select>
  <delete id="deleteByExample" parameterType="com.chinasofti.domain.DrawInfoExample" >
    delete from CIS_DRAWINFO
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
  </delete>
  <insert id="insert" parameterType="com.chinasofti.domain.DrawInfo" >
    insert into CIS_DRAWINFO (CD_ID, CD_DRAWNO, CD_APPRTIME, 
      CD_ENDTIME, CD_DESUNIT, CD_ENTID, 
      CD_RESPPERSION, CD_SHIPNO, CD_REBSHIPNUM, 
      CD_SHIPLENGTH, CD_TONNAGE, CD_POWER, 
      CD_SPEED, CD_WATER, CD_SHIPTYPE, 
      CD_SHIPTYPEID, CD_SHIPAREA, CD_SHIPAREAID, 
      CD_PEOPLECOUNT, CD_JOBAREA, CD_APPLYUNIT, 
      CD_APPLYUNIT_ID, CD_DRAMSHIPNAME, CD_ENGINEROOM_TYPE
      )
    values (#{id,jdbcType=VARCHAR}, #{drawno,jdbcType=VARCHAR}, #{apprtime,jdbcType=VARCHAR}, 
      #{endtime,jdbcType=VARCHAR}, #{desunit,jdbcType=VARCHAR}, #{entid,jdbcType=VARCHAR}, 
      #{resppersion,jdbcType=VARCHAR}, #{shipno,jdbcType=VARCHAR}, #{rebshipnum,jdbcType=DECIMAL}, 
      #{shiplength,jdbcType=VARCHAR}, #{tonnage,jdbcType=VARCHAR}, #{power,jdbcType=VARCHAR}, 
      #{speed,jdbcType=VARCHAR}, #{water,jdbcType=VARCHAR}, #{shiptype,jdbcType=VARCHAR}, 
      #{shiptypeid,jdbcType=VARCHAR}, #{shiparea,jdbcType=VARCHAR}, #{shipareaid,jdbcType=VARCHAR}, 
      #{peoplecount,jdbcType=VARCHAR}, #{jobarea,jdbcType=VARCHAR}, #{applyunit,jdbcType=VARCHAR}, 
      #{applyunitId,jdbcType=VARCHAR}, #{dramshipname,jdbcType=VARCHAR}, #{engineroomType,jdbcType=VARCHAR}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.chinasofti.domain.DrawInfo" >
    insert into CIS_DRAWINFO
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        CD_ID,
      </if>
      <if test="drawno != null" >
        CD_DRAWNO,
      </if>
      <if test="apprtime != null" >
        CD_APPRTIME,
      </if>
      <if test="endtime != null" >
        CD_ENDTIME,
      </if>
      <if test="desunit != null" >
        CD_DESUNIT,
      </if>
      <if test="entid != null" >
        CD_ENTID,
      </if>
      <if test="resppersion != null" >
        CD_RESPPERSION,
      </if>
      <if test="shipno != null" >
        CD_SHIPNO,
      </if>
      <if test="rebshipnum != null" >
        CD_REBSHIPNUM,
      </if>
      <if test="shiplength != null" >
        CD_SHIPLENGTH,
      </if>
      <if test="tonnage != null" >
        CD_TONNAGE,
      </if>
      <if test="power != null" >
        CD_POWER,
      </if>
      <if test="speed != null" >
        CD_SPEED,
      </if>
      <if test="water != null" >
        CD_WATER,
      </if>
      <if test="shiptype != null" >
        CD_SHIPTYPE,
      </if>
      <if test="shiptypeid != null" >
        CD_SHIPTYPEID,
      </if>
      <if test="shiparea != null" >
        CD_SHIPAREA,
      </if>
      <if test="shipareaid != null" >
        CD_SHIPAREAID,
      </if>
      <if test="peoplecount != null" >
        CD_PEOPLECOUNT,
      </if>
      <if test="jobarea != null" >
        CD_JOBAREA,
      </if>
      <if test="applyunit != null" >
        CD_APPLYUNIT,
      </if>
      <if test="applyunitId != null" >
        CD_APPLYUNIT_ID,
      </if>
      <if test="dramshipname != null" >
        CD_DRAMSHIPNAME,
      </if>
      <if test="engineroomType != null" >
        CD_ENGINEROOM_TYPE,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="drawno != null" >
        #{drawno,jdbcType=VARCHAR},
      </if>
      <if test="apprtime != null" >
        #{apprtime,jdbcType=VARCHAR},
      </if>
      <if test="endtime != null" >
        #{endtime,jdbcType=VARCHAR},
      </if>
      <if test="desunit != null" >
        #{desunit,jdbcType=VARCHAR},
      </if>
      <if test="entid != null" >
        #{entid,jdbcType=VARCHAR},
      </if>
      <if test="resppersion != null" >
        #{resppersion,jdbcType=VARCHAR},
      </if>
      <if test="shipno != null" >
        #{shipno,jdbcType=VARCHAR},
      </if>
      <if test="rebshipnum != null" >
        #{rebshipnum,jdbcType=DECIMAL},
      </if>
      <if test="shiplength != null" >
        #{shiplength,jdbcType=VARCHAR},
      </if>
      <if test="tonnage != null" >
        #{tonnage,jdbcType=VARCHAR},
      </if>
      <if test="power != null" >
        #{power,jdbcType=VARCHAR},
      </if>
      <if test="speed != null" >
        #{speed,jdbcType=VARCHAR},
      </if>
      <if test="water != null" >
        #{water,jdbcType=VARCHAR},
      </if>
      <if test="shiptype != null" >
        #{shiptype,jdbcType=VARCHAR},
      </if>
      <if test="shiptypeid != null" >
        #{shiptypeid,jdbcType=VARCHAR},
      </if>
      <if test="shiparea != null" >
        #{shiparea,jdbcType=VARCHAR},
      </if>
      <if test="shipareaid != null" >
        #{shipareaid,jdbcType=VARCHAR},
      </if>
      <if test="peoplecount != null" >
        #{peoplecount,jdbcType=VARCHAR},
      </if>
      <if test="jobarea != null" >
        #{jobarea,jdbcType=VARCHAR},
      </if>
      <if test="applyunit != null" >
        #{applyunit,jdbcType=VARCHAR},
      </if>
      <if test="applyunitId != null" >
        #{applyunitId,jdbcType=VARCHAR},
      </if>
      <if test="dramshipname != null" >
        #{dramshipname,jdbcType=VARCHAR},
      </if>
      <if test="engineroomType != null" >
        #{engineroomType,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <select id="countByExample" parameterType="com.chinasofti.domain.DrawInfoExample" resultType="java.lang.Integer" >
    select count(*) from CIS_DRAWINFO
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
  </select>
  <update id="updateByExampleSelective" parameterType="map" >
    update CIS_DRAWINFO
    <set >
      <if test="record.id != null" >
        CD_ID = #{record.id,jdbcType=VARCHAR},
      </if>
      <if test="record.drawno != null" >
        CD_DRAWNO = #{record.drawno,jdbcType=VARCHAR},
      </if>
      <if test="record.apprtime != null" >
        CD_APPRTIME = #{record.apprtime,jdbcType=VARCHAR},
      </if>
      <if test="record.endtime != null" >
        CD_ENDTIME = #{record.endtime,jdbcType=VARCHAR},
      </if>
      <if test="record.desunit != null" >
        CD_DESUNIT = #{record.desunit,jdbcType=VARCHAR},
      </if>
      <if test="record.entid != null" >
        CD_ENTID = #{record.entid,jdbcType=VARCHAR},
      </if>
      <if test="record.resppersion != null" >
        CD_RESPPERSION = #{record.resppersion,jdbcType=VARCHAR},
      </if>
      <if test="record.shipno != null" >
        CD_SHIPNO = #{record.shipno,jdbcType=VARCHAR},
      </if>
      <if test="record.rebshipnum != null" >
        CD_REBSHIPNUM = #{record.rebshipnum,jdbcType=DECIMAL},
      </if>
      <if test="record.shiplength != null" >
        CD_SHIPLENGTH = #{record.shiplength,jdbcType=VARCHAR},
      </if>
      <if test="record.tonnage != null" >
        CD_TONNAGE = #{record.tonnage,jdbcType=VARCHAR},
      </if>
      <if test="record.power != null" >
        CD_POWER = #{record.power,jdbcType=VARCHAR},
      </if>
      <if test="record.speed != null" >
        CD_SPEED = #{record.speed,jdbcType=VARCHAR},
      </if>
      <if test="record.water != null" >
        CD_WATER = #{record.water,jdbcType=VARCHAR},
      </if>
      <if test="record.shiptype != null" >
        CD_SHIPTYPE = #{record.shiptype,jdbcType=VARCHAR},
      </if>
      <if test="record.shiptypeid != null" >
        CD_SHIPTYPEID = #{record.shiptypeid,jdbcType=VARCHAR},
      </if>
      <if test="record.shiparea != null" >
        CD_SHIPAREA = #{record.shiparea,jdbcType=VARCHAR},
      </if>
      <if test="record.shipareaid != null" >
        CD_SHIPAREAID = #{record.shipareaid,jdbcType=VARCHAR},
      </if>
      <if test="record.peoplecount != null" >
        CD_PEOPLECOUNT = #{record.peoplecount,jdbcType=VARCHAR},
      </if>
      <if test="record.jobarea != null" >
        CD_JOBAREA = #{record.jobarea,jdbcType=VARCHAR},
      </if>
      <if test="record.applyunit != null" >
        CD_APPLYUNIT = #{record.applyunit,jdbcType=VARCHAR},
      </if>
      <if test="record.applyunitId != null" >
        CD_APPLYUNIT_ID = #{record.applyunitId,jdbcType=VARCHAR},
      </if>
      <if test="record.dramshipname != null" >
        CD_DRAMSHIPNAME = #{record.dramshipname,jdbcType=VARCHAR},
      </if>
      <if test="record.engineroomType != null" >
        CD_ENGINEROOM_TYPE = #{record.engineroomType,jdbcType=VARCHAR},
      </if>
    </set>
    <if test="_parameter != null" >
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByExample" parameterType="map" >
    update CIS_DRAWINFO
    set CD_ID = #{record.id,jdbcType=VARCHAR},
      CD_DRAWNO = #{record.drawno,jdbcType=VARCHAR},
      CD_APPRTIME = #{record.apprtime,jdbcType=VARCHAR},
      CD_ENDTIME = #{record.endtime,jdbcType=VARCHAR},
      CD_DESUNIT = #{record.desunit,jdbcType=VARCHAR},
      CD_ENTID = #{record.entid,jdbcType=VARCHAR},
      CD_RESPPERSION = #{record.resppersion,jdbcType=VARCHAR},
      CD_SHIPNO = #{record.shipno,jdbcType=VARCHAR},
      CD_REBSHIPNUM = #{record.rebshipnum,jdbcType=DECIMAL},
      CD_SHIPLENGTH = #{record.shiplength,jdbcType=VARCHAR},
      CD_TONNAGE = #{record.tonnage,jdbcType=VARCHAR},
      CD_POWER = #{record.power,jdbcType=VARCHAR},
      CD_SPEED = #{record.speed,jdbcType=VARCHAR},
      CD_WATER = #{record.water,jdbcType=VARCHAR},
      CD_SHIPTYPE = #{record.shiptype,jdbcType=VARCHAR},
      CD_SHIPTYPEID = #{record.shiptypeid,jdbcType=VARCHAR},
      CD_SHIPAREA = #{record.shiparea,jdbcType=VARCHAR},
      CD_SHIPAREAID = #{record.shipareaid,jdbcType=VARCHAR},
      CD_PEOPLECOUNT = #{record.peoplecount,jdbcType=VARCHAR},
      CD_JOBAREA = #{record.jobarea,jdbcType=VARCHAR},
      CD_APPLYUNIT = #{record.applyunit,jdbcType=VARCHAR},
      CD_APPLYUNIT_ID = #{record.applyunitId,jdbcType=VARCHAR},
      CD_DRAMSHIPNAME = #{record.dramshipname,jdbcType=VARCHAR},
      CD_ENGINEROOM_TYPE = #{record.engineroomType,jdbcType=VARCHAR}
    <if test="_parameter != null" >
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <sql id="OracleDialectPrefix" >
    <if test="page != null" >
      select * from ( select row_.*, rownum rownum_ from ( 
    </if>
  </sql>
  <sql id="OracleDialectSuffix" >
    <if test="page != null" >
      <![CDATA[ ) row_ ) where rownum_ > #{page.start} and rownum_ <= #{page.end} ]]>
    </if>
  </sql>
  <select id="getShipsOfDrawBuid" resultType="int">
    SELECT  COUNT(*) FROM CIS_SHIPINFO WHERE CS_DRAWNO IN
    (SELECT CD_DRAWNO FROM CIS_DRAWINFO
    WHERE CD_ENTID = #{pid})
  </select>
  <select id="getDrawPassRate" resultType="float">
    SELECT case when t2.num>0 then round((t1.num/t2.num)*100,2) else 0 end "firstPassRate" FROM
    (SELECT count(*) num FROM
    (SELECT COUNT(*) num FROM CIS_DRAW_CHECK WHERE CDC_DRAWNO IN
    (SELECT cdc.CDC_DRAWNO FROM CIS_DRAW_CHECK cdc INNER JOIN CIS_DRAWINFO cdi ON cdc.CDC_DRAWNO = cdi.CD_DRAWNO WHERE cdi.CD_ENTID=#{pid} AND cdc.CDC_CHECKPASS = '1')
    GROUP BY CDC_DRAWNO) t
    WHERE t.num = #{nums}) t1,
    (SELECT count(DISTINCT cdc.CDC_DRAWNO) num FROM CIS_DRAW_CHECK cdc INNER JOIN CIS_DRAWINFO cdi ON cdc.CDC_DRAWNO = cdi.CD_DRAWNO WHERE cdi.CD_ENTID=#{pid}) t2
  </select>

  <select id="getDrawInfoByEntId" resultMap="BaseResultMap">
    SELECT * FROM
    (SELECT a.*,rownum rn FROM
    (SELECT cd.*,cdc.CDC_YCSNAME
    FROM  CIS_DRAWINFO cd LEFT JOIN  CIS_DRAW_CHECK cdc ON  cd.CD_DRAWNO =cdc.CDC_DRAWNO
    WHERE cd.CD_ENTID = #{pid}
    <if test="keyWord!=null">
      AND (cd.CD_DRAWNO LIKE  #{keyWord} OR cd.CD_RESPPERSION LIKE #{keyWord} OR cdc.CDC_YCSNAME LIKE #{keyWord})
    </if>
    ORDER BY cd.CD_APPRTIME) a
    WHERE rownum&lt;#{endRow})
    WHERE rn &gt;#{beginRow}
  </select>
  <select id="countDrawInfoByEntId" resultType="int">
    SELECT count(*)
    FROM  CIS_DRAWINFO cd LEFT JOIN  CIS_DRAW_CHECK cdc ON  cd.CD_DRAWNO =cdc.CDC_DRAWNO
    WHERE cd.CD_ENTID = #{pid}
    <if test="keyWord!=null">
      AND (cd.CD_DRAWNO LIKE  #{keyWord} OR cd.CD_RESPPERSION LIKE #{keyWord} OR cdc.CDC_YCSNAME LIKE #{keyWord})
    </if>
  </select>
  <!--select cd.cd_drawno,cd.CD_RESPPERSION,count(cs.cs_Drawno)-->
  <!--from CIS_DRAWINFO cd left join cis_shipInfo cs on cd.cd_drawno = cs.cs_drawno  group by cd.cd_drawno,cd.CD_RESPPERSION-->
  <select id="getDrawBuildByEntId" resultMap="BaseResultMap">
    SELECT * FROM
    (SELECT a.*,rownum rn FROM
    (SELECT cd.CD_DRAWNO,cd.CD_RESPPERSION,count(cs.CS_DRAWNO) "drawNums"
    FROM  CIS_DRAWINFO cd LEFT JOIN  CIS_SHIPINFO cs on cd.CD_DRAWNO = cs.CS_DRAWNO
    WHERE cd.CD_ENTID = #{pid}
    <if test="keyWord!=null">
      AND (cd.CD_DRAWNO LIKE  #{keyWord} OR cd.CD_RESPPERSION LIKE #{keyWord})
    </if>
    ORDER BY cd.CD_APPRTIME) a
    WHERE rownum&lt;#{endRow})
    WHERE rn &gt;#{beginRow}
  </select>
  <select id="countDrawBuildByEntId" resultType="int">
    SELECT count(*)
    FROM  CIS_DRAWINFO cd LEFT JOIN  CIS_DRAW_CHECK cdc ON  cd.CD_DRAWNO =cdc.CDC_DRAWNO
    WHERE cd.CD_ENTID = #{pid}
    <if test="keyWord!=null">
      AND (cd.CD_DRAWNO LIKE  #{keyWord} OR cd.CD_RESPPERSION LIKE #{keyWord} OR cdc.CDC_YCSNAME LIKE #{keyWord})
    </if>
  </select>

  <select id="countByApprTimeYear" resultType="int">
    select count(*) FROM CIS_DRAWINFO WHERE substr(CD_APPRTIME,0,4) = #{lastYear}
  </select>

  <select id="countDrawsGroupYear" resultType="java.util.HashMap">
    select substr(CD_APPRTIME,0,4) "year", count(*) "nums" FROM CIS_DRAWINFO WHERE CD_SHIPTYPEREAL = #{jobArea}
    <if test="bYear != null">
      AND substr(CD_APPRTIME,0,4) &gt; = #{bYear}
    </if>
    <if test="eYear != null">
      AND substr(CD_APPRTIME,0,4) &lt; = #{eYear}
    </if>
    GROUP BY substr(CD_APPRTIME,0,4)
    ORDER BY substr(CD_APPRTIME,0,4) ASC
  </select>
</mapper>